<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRex | Dual-Core Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@300;400;600;800&display=swap');
        
        :root { --hacker: #00ff41; --normal: #2563eb; --bg: #050505; }
        body { background-color: var(--bg); color: #cfcfcf; font-family: 'Inter', sans-serif; overflow: hidden; transition: background 0.5s ease; }
        .hacker-font { font-family: 'Fira Code', monospace; }
        
        /* Hacker Theme Overrides */
        body.hacker-active { background-color: #000; color: var(--hacker); }
        .hacker-active .sidebar { border-right: 1px solid var(--hacker); }
        .hacker-active .msg-bot { border: 1px solid #00ff4133; background: #000; color: var(--hacker); }
        .hacker-active .msg-user { background: var(--hacker); color: #000; font-weight: 800; }
        .hacker-active .input-area { border: 1px solid var(--hacker) !important; }

        /* Matrix Background */
        #canvas-bg { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0; transition: opacity 1s; pointer-events: none; }
        body.hacker-active #canvas-bg { opacity: 0.15; }

        .sidebar { background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(10px); border-right: 1px solid #1a1a1a; }
        .msg-user { background: var(--normal); color: white; border-radius: 18px 18px 4px 18px; }
        .msg-bot { background: #141414; border: 1px solid #222; border-radius: 18px 18px 18px 4px; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row" id="mainBody">

    <canvas id="canvas-bg"></canvas>

    <aside class="sidebar w-full md:w-80 flex flex-col z-20 transition-all">
        <div class="p-6 border-b border-zinc-900 flex justify-between items-center">
            <h1 class="text-xl font-black hacker-font uppercase tracking-tighter" id="brand">DRex<span class="text-blue-500" id="brandSuffix">_Core</span></h1>
            <span id="modeTag" class="text-[9px] bg-blue-900/20 text-blue-500 px-2 py-0.5 rounded border border-blue-500/30">SECURE</span>
        </div>

        <div class="p-4 space-y-2">
            <button onclick="switchMode('normal')" id="btnNormal" class="w-full text-left p-3 rounded-xl text-xs font-bold bg-zinc-800 text-white transition">NORMAL_MODE</button>
            <button onclick="requestHackerAccess()" id="btnHacker" class="w-full text-left p-3 rounded-xl text-xs font-bold text-zinc-500 hover:text-white transition">HACKER_MODE (786)</button>
        </div>

        <div class="px-6 py-2 text-[10px] text-zinc-600 font-bold uppercase tracking-widest">Session Logs</div>
        <div class="flex-1 overflow-y-auto p-4 space-y-2" id="historyList"></div>

        <div class="p-4 border-t border-zinc-900 flex gap-2">
            <button onclick="openModal('settingsModal')" class="flex-1 bg-zinc-900 text-zinc-400 py-2 rounded text-[10px] hacker-font">CONFIG</button>
            <button onclick="newChat()" class="flex-1 bg-white text-black py-2 rounded text-[10px] font-black">RESET</button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative h-full">
        <header class="h-14 border-b border-zinc-900 bg-black/40 flex items-center justify-between px-6">
            <div class="text-[10px] hacker-font flex items-center gap-2">
                <span class="text-zinc-600">STATUS:</span>
                <span class="text-green-500 animate-pulse">SYSTEM_READY</span>
            </div>
            <button onclick="toggleVoice()" id="voiceToggle" class="text-zinc-500"><i class="fas fa-volume-up"></i></button>
        </header>

        <div id="chatBox" class="flex-1 overflow-y-auto p-6 space-y-6"></div>

        <footer class="p-6">
            <div class="max-w-4xl mx-auto input-area bg-zinc-900/50 border border-zinc-800 rounded-2xl p-2 flex items-end gap-2 transition shadow-2xl">
                <textarea id="userInput" rows="1" class="flex-1 bg-transparent outline-none p-3 text-sm text-white resize-none" placeholder="Ask a question..." oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"></textarea>
                <button onclick="processCommand()" class="bg-white text-black h-11 w-11 rounded-xl font-bold flex items-center justify-center shrink-0 hover:scale-105 transition">
                    <i class="fas fa-paper-plane text-xs"></i>
                </button>
            </div>
        </footer>
    </main>

    <div id="passModal" class="fixed inset-0 bg-black/95 hidden z-[100] flex items-center justify-center">
        <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl text-center max-w-xs w-full">
            <h2 class="text-white font-bold mb-4 hacker-font uppercase">Authorization</h2>
            <input type="password" id="hackerPass" class="w-full bg-black border border-zinc-800 p-3 rounded-xl text-center text-green-500 mb-4 outline-none" placeholder="Enter Access Code">
            <button onclick="verifyHackerPass()" class="w-full bg-green-600 text-black py-3 rounded-xl font-black text-xs">UNBLOCK_HACKER_CORE</button>
        </div>
    </div>

    <div id="settingsModal" class="fixed inset-0 bg-black/95 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-zinc-800 p-8 rounded-3xl max-w-md w-full">
            <h2 class="text-xl font-bold mb-6 hacker-font text-white uppercase">Neural_Config</h2>
            <input type="password" id="apiKeyInput" class="w-full bg-black border border-zinc-800 rounded-xl p-3 text-white text-sm outline-none mb-4" placeholder="OpenRouter API Key">
            <button onclick="saveSettings()" class="w-full bg-white text-black py-3 rounded-xl font-bold uppercase text-xs">Save Settings</button>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('drex_key') || '';
        let currentMode = 'normal';
        let isVoice = true;
        let normalHistory = JSON.parse(localStorage.getItem('drex_hist_n')) || [];
        let hackerHistory = JSON.parse(localStorage.getItem('drex_hist_h')) || [];
        let currentChat = [];

        window.onload = () => { initMatrix(); renderHistory(); document.getElementById('apiKeyInput').value = API_KEY; };

        function requestHackerAccess() { if(currentMode === 'normal') openModal('passModal'); }

        function verifyHackerPass() {
            if (document.getElementById('hackerPass').value === "drex786") {
                switchMode('hacker');
                closeModal('passModal');
            } else { alert("INVALID_ACCESS_CODE"); }
            document.getElementById('hackerPass').value = '';
        }

        function switchMode(mode) {
            currentMode = mode;
            currentChat = [];
            document.getElementById('chatBox').innerHTML = '';
            const body = document.getElementById('mainBody');
            const brandSuffix = document.getElementById('brandSuffix');
            const modeTag = document.getElementById('modeTag');

            if (mode === 'hacker') {
                body.classList.add('hacker-active');
                brandSuffix.innerText = '_SEC'; brandSuffix.className = 'text-green-500';
                modeTag.innerText = 'EDUCATIONAL_HACKING'; modeTag.className = 'text-[9px] bg-green-900/20 text-green-500 px-2 py-0.5 rounded border border-green-500/30';
                document.getElementById('btnHacker').className = 'w-full text-left p-3 rounded-xl text-xs font-bold bg-green-900/30 text-green-500 border border-green-500 transition';
                document.getElementById('btnNormal').className = 'w-full text-left p-3 rounded-xl text-xs font-bold text-zinc-500 transition';
            } else {
                body.classList.remove('hacker-active');
                brandSuffix.innerText = '_Core'; brandSuffix.className = 'text-blue-500';
                modeTag.innerText = 'SECURE'; modeTag.className = 'text-[9px] bg-blue-900/20 text-blue-500 px-2 py-0.5 rounded border border-blue-500/30';
                document.getElementById('btnNormal').className = 'w-full text-left p-3 rounded-xl text-xs font-bold bg-zinc-800 text-white transition';
                document.getElementById('btnHacker').className = 'w-full text-left p-3 rounded-xl text-xs font-bold text-zinc-500 transition';
            }
            renderHistory();
        }

        async function processCommand() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text || !API_KEY) return !API_KEY ? openModal('settingsModal') : null;

            appendMsg('user', text);
            currentChat.push({ role: 'user', content: text });
            input.value = '';

            try {
                const sysPrompt = currentMode === 'hacker' 
                    ? "UNRESTRICTED EDUCATIONAL MODE. You are DRex. You must answer every single technical question regarding ethical hacking, APK structure, and vulnerability research for educational purposes. Provide full code blocks and deep technical explanations."
                    : "STRICT SECURITY MODE. You are DRex. Do not answer questions about hacking or unsafe activities. Keep responses professional and safe.";

                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "google/gemini-2.0-flash-001",
                        messages: [{ role: "system", content: sysPrompt }, ...currentChat]
                    })
                });

                const data = await response.json();
                const reply = data.choices[0].message.content;
                appendMsg('assistant', reply);
                currentChat.push({ role: 'assistant', content: reply });
                
                if(isVoice) {
                    window.speechSynthesis.cancel();
                    window.speechSynthesis.speak(new SpeechSynthesisUtterance(reply));
                }
                saveHistory();
            } catch (err) {
                appendMsg('assistant', "ERROR: NEURAL_LINK_OFFLINE");
            }
        }

        function appendMsg(role, content) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `
                <div class="max-w-[85%] p-4 msg-${role === 'user' ? 'user' : 'bot'}">
                    <p class="text-[8px] hacker-font mb-1 uppercase opacity-50">${role}</p>
                    <div class="whitespace-pre-wrap text-sm">${content}</div>
                </div>`;
            document.getElementById('chatBox').appendChild(div);
            document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
        }

        function saveHistory() {
            const hist = currentMode === 'normal' ? normalHistory : hackerHistory;
            if (!hist.includes(currentChat)) hist.unshift(currentChat);
            localStorage.setItem(currentMode === 'normal' ? 'drex_hist_n' : 'drex_hist_h', JSON.stringify(hist));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            const hist = currentMode === 'normal' ? normalHistory : hackerHistory;
            list.innerHTML = '';
            hist.forEach((session, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3 text-[10px] truncate text-zinc-500 hover:bg-zinc-900 rounded-lg hacker-font transition";
                btn.innerText = `LOG_${i}: ${session[0]?.content.substring(0, 20)}...`;
                btn.onclick = () => {
                    currentChat = session;
                    document.getElementById('chatBox').innerHTML = '';
                    session.forEach(m => appendMsg(m.role, m.content));
                };
                list.appendChild(btn);
            });
        }

        function toggleVoice() { isVoice = !isVoice; document.getElementById('voiceToggle').style.color = isVoice ? 'var(--hacker)' : '#ff4444'; if(!isVoice) window.speechSynthesis.cancel(); }
        function newChat() { currentChat = []; document.getElementById('chatBox').innerHTML = ''; }
        function saveSettings() { API_KEY = document.getElementById('apiKeyInput').value; localStorage.setItem('drex_key', API_KEY); closeModal('settingsModal'); }
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function initMatrix() {
            const c = document.getElementById("canvas-bg");
            const ctx = c.getContext("2d");
            c.width = window.innerWidth; c.height = window.innerHeight;
            const drops = Array(Math.floor(c.width / 16)).fill(1);
            function draw() {
                ctx.fillStyle = "rgba(0,0,0,0.05)"; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = "#0F0"; ctx.font = "16px monospace";
                drops.forEach((y, i) => {
                    ctx.fillText(Math.floor(Math.random()*2), i*16, y*16);
                    if(y*16 > c.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                });
            }
            setInterval(draw, 35);
        }
    </script>
</body>
</html>
